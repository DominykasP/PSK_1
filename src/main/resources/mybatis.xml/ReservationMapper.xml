<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="lt.vu.mybatis.dao.ReservationMapper">
  <resultMap id="BaseResultMap" type="lt.vu.mybatis.model.Reservation">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 20 21:45:59 EEST 2020.
    -->
    <id column="ID" jdbcType="INTEGER" property="id" />
    <result column="DATE_FROM" jdbcType="DATE" property="dateFrom" />
    <result column="DATE_TO" jdbcType="DATE" property="dateTo" />
    <result column="IS_CHECKED_IN" jdbcType="BOOLEAN" property="isCheckedIn" />
    <result column="CLIENT_ID" jdbcType="INTEGER" property="clientId" />
    <result column="ROOM_ID" jdbcType="INTEGER" property="roomId" />

<!--    Added manually-->
    <association property="room" javaType="Room">
      <id column="ROOM_ID" jdbcType="INTEGER" property="id" />
      <result column="ROOM_NUMBER" jdbcType="INTEGER" property="number"/>
      <result column="ROOM_TYPE_ID" jdbcType="INTEGER" property="roomTypeId"/>
      <association property="roomtype" javaType="Roomtype">
        <id column="ROOM_ID" jdbcType="INTEGER" property="id" />
        <result column="ROOM_TYPE_NIGHT_PRICE" jdbcType="INTEGER" property="nightPrice"/>
        <result column="ROOM_TYPE_SIZE" jdbcType="INTEGER" property="size"/>
        <result column="ROOM_TYPE_TYPE" jdbcType="VARCHAR" property="type"/>
      </association>
    </association>
    <association property="client" javaType="Client">
      <id column="CLIENT_ID" jdbcType="INTEGER" property="id" />
      <result column="CLIENT_NAME" jdbcType="VARCHAR" property="name" />
      <result column="CLIENT_SURNAME" jdbcType="VARCHAR" property="surname" />
      <result column="CLIENT_EMAIL" jdbcType="VARCHAR" property="email" />
      <result column="CLIENT_PHONE_NR" jdbcType="VARCHAR" property="phoneNr" />
    </association>
    <collection property="aditionalRequests" ofType="AditionalRequest">
      <id column="REQUEST_ID" jdbcType="INTEGER" property="id" />
      <id column="REQUEST_REQUEST" jdbcType="VARCHAR" property="request" />
    </collection>

  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 20 21:45:59 EEST 2020.
    -->
    delete from PUBLIC.RESERVATION
    where ID = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" keyColumn="ID" keyProperty="id" parameterType="lt.vu.mybatis.model.Reservation" useGeneratedKeys="true">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 20 21:45:59 EEST 2020.
    -->
    insert into PUBLIC.RESERVATION (DATE_FROM, DATE_TO, IS_CHECKED_IN,
      CLIENT_ID, ROOM_ID)
    values (#{dateFrom,jdbcType=DATE}, #{dateTo,jdbcType=DATE}, #{isCheckedIn,jdbcType=BOOLEAN},
      #{clientId,jdbcType=INTEGER}, #{roomId,jdbcType=INTEGER})
  </insert>
  <update id="updateByPrimaryKey" parameterType="lt.vu.mybatis.model.Reservation">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 20 21:45:59 EEST 2020.
    -->
    update PUBLIC.RESERVATION
    set DATE_FROM = #{dateFrom,jdbcType=DATE},
      DATE_TO = #{dateTo,jdbcType=DATE},
      IS_CHECKED_IN = #{isCheckedIn,jdbcType=BOOLEAN},
      CLIENT_ID = #{clientId,jdbcType=INTEGER},
      ROOM_ID = #{roomId,jdbcType=INTEGER}
    where ID = #{id,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select r.ID, r.DATE_FROM, r.DATE_TO, r.IS_CHECKED_IN,
           room.ID as ROOM_ID, room.NUMBER as ROOM_NUMBER,
           t.ID as ROOM_TYPE_ID, t.NIGHT_PRICE as ROOM_TYPE_NIGHT_PRICE, t.SIZE as ROOM_TYPE_SIZE, t.TYPE as ROOM_TYPE_TYPE,
           c.ID as CLIENT_ID, c.NAME as CLIENT_NAME, c.SURNAME as CLIENT_SURNAME, c.EMAIL as CLIENT_EMAIL, c.PHONE_NR as CLIENT_PHONE_NR,
           RtoAR.ADITIONALREQUESTS_ID as REQUEST_ID, ar.REQUEST as REQUEST_REQUEST
     from PUBLIC.RESERVATION r
     join PUBLIC.ROOM room on r.ROOM_ID = room.ID
     join PUBLIC.ROOMTYPE t on room.ROOM_TYPE_ID = t.ID
     join PUBLIC.CLIENT c on r.CLIENT_ID = c.ID
     left join PUBLIC.RESERVATION_ADITIONAL_REQUEST RtoAR on RtoAR.RESERVATION_ID = r.ID
     left join PUBLIC.ADITIONAL_REQUEST ar on ar.ID = RtoAR.ADITIONALREQUESTS_ID
    where r.ID = #{id,jdbcType=INTEGER}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    select r.ID, r.DATE_FROM, r.DATE_TO, r.IS_CHECKED_IN,
           room.ID as ROOM_ID, room.NUMBER as ROOM_NUMBER,
           t.ID as ROOM_TYPE_ID, t.NIGHT_PRICE as ROOM_TYPE_NIGHT_PRICE, t.SIZE as ROOM_TYPE_SIZE, t.TYPE as ROOM_TYPE_TYPE,
           c.ID as CLIENT_ID, c.NAME as CLIENT_NAME, c.SURNAME as CLIENT_SURNAME, c.EMAIL as CLIENT_EMAIL, c.PHONE_NR as CLIENT_PHONE_NR,
           RtoAR.ADITIONALREQUESTS_ID as REQUEST_ID, ar.REQUEST as REQUEST_REQUEST
      from PUBLIC.RESERVATION r
      join PUBLIC.ROOM room on r.ROOM_ID = room.ID
      join PUBLIC.ROOMTYPE t on room.ROOM_TYPE_ID = t.ID
      join PUBLIC.CLIENT c on r.CLIENT_ID = c.ID
      left join PUBLIC.RESERVATION_ADITIONAL_REQUEST RtoAR on RtoAR.RESERVATION_ID = r.ID
      left join PUBLIC.ADITIONAL_REQUEST ar on ar.ID = RtoAR.ADITIONALREQUESTS_ID
  </select>
</mapper>